# チャンネルレイアウト拡張計画 (日本語版)

英語版: [channel_layout_expansion.md](channel_layout_expansion.md)

## 背景
- 以前のビルドは Dolby Atmos 7.1.4（12 チャンネル）のみ対応していました。
- JUCE の AudioChannelSet には 7.1.2、7.1.6、5.1.x、9.1.x など追加の没入型レイアウトが定義されており、実運用で必要です。

## フェーズ構成
1. **基盤整備**: 固定長 std::array をレイアウト依存の std::vector に置き換え、uildSpeakerDefinitions() でレイアウトごとの定義を生成。
2. **7.x ファミリ**: 7.1.2 / 7.1.6 のシードを追加し、方位角／仰角テーブルを調整。プリセットズーム制約の妥当性も確認。
3. **5.x ファミリ**: 5.1 / 5.1.2 / 5.1.4 を実装。存在しないスピーカーは隙間を残さず非表示にする。
4. **9.x 以上**: ワイドおよびトップサイドスピーカーを導入し、ラベルの衝突回避を再調整。高密度レイアウト向けにカメラプリセットも見直す。
5. **汎用レイアウト**: AudioChannelSet::discreteChannels() を扱い、外部提供の位置／ラベルメタデータを受け取れるようにする。

## テスト観点
- AudioChannelSet のチャンネルタイプと定義シードが 1:1 で対応していること。
- processBlock は未定義スピーカーをスキップしても状態が破損しないこと。
- Inside / Outside のラベルが可読で、重なりが発生しないこと。
- Heatmap / Trails / Peak Hold がスピーカー数に依存せず正しく描画されること。
- 既存の 7.1.4 セッションで回帰が起きないこと。

## 現行スコープ (v0.6.0)
- フェーズ 1 の基盤整備。
- 7.x 系の 7.1.2 および 7.1.6 をサポート。
- README / user_manual / requirements のドキュメント更新。

## 進捗 (2025-10-29)
- フェーズ 1 を完了し、モノラル／ステレオから Dolby Atmos 9.1.6（Atmos / ITU 変種）までの JUCE レイアウト自動検出を実装。
- 今後の課題: 離散／カスタムレイアウト対応と、ワイド／ハイト追加時のビジュアル調整。
